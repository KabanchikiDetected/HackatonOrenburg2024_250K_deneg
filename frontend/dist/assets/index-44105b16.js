import{r as c,j as s,L as _}from"./index-26fc34b5.js";const w=()=>{const[o,v]=c.useState(localStorage.getItem("token")),[l,d]=c.useState([]);c.useEffect(()=>{u()},[]);const u=()=>{fetch("/api/news/feed/").then(e=>e.json()).then(e=>{Promise.all(e.map(t=>fetch(`/api/students/${t.author_id}`).then(a=>a.json()).then(a=>({...t,author:{...a,education:"No University"},parsed_hashtags:j(t),is_liked:m(t.id)})))).then(t=>{Promise.all(t.map(a=>k(a.author_id).then(r=>({...a,author:{...a.author,education:r}})))).then(a=>{d(a)})})}).catch(e=>console.error("Error fetching news:",e))},m=async e=>{if(o)try{return(await(await fetch(`/api/news/${e}/like/`,{method:"GET",headers:{Authorization:`Bearer ${o}`}})).json()).liked}catch(t){console.error("Error fetching like status:",t)}return!1},g=e=>{const t=new Date(e*1e3),a=["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"],r=t.getDate().toString().padStart(2,"0"),n=a[t.getMonth()],i=t.getHours().toString().padStart(2,"0"),f=t.getMinutes().toString().padStart(2,"0");return`${r} ${n} ${i}:${f}`},j=e=>JSON.parse(e.hashtags),x=e=>{async function t(a){try{const n=await(await fetch(`/api/news/${a}/like/`,{method:"POST",headers:{Authorization:`Bearer ${o}`}})).json();if(n==="You have put a like")return{liked:!0};if(n==="You removed the like")return{liked:!1}}catch(r){console.error("Error fetching like status:",r)}return{liked:!1}}o?t(e).then(r=>{d([...l.map(n=>({...n,is_liked:r.liked,likes:n.id===e?r.liked===!0?n.likes+1:n.likes-1:n.likes}))])}):console.log("Not authorized")},h=e=>{const t=JSON.parse(e.images);return t.length>0?t[0]:""};async function k(e){async function t(r){try{const i=await(await fetch(`/api/universities/user/education/${r}/`,{method:"GET"})).json();return`${i.university.short_name}, ${i.department.short_name}, ${i.group.name}`}catch(n){console.error("Error fetching like status:",n)}return"No University"}return await await t(e)}return s.jsx("main",{className:"feed",children:s.jsx("div",{className:"posts",children:l.map(e=>{var t,a,r;return s.jsxs("div",{className:"post",children:[s.jsxs("div",{className:"post__row row",children:[s.jsx("div",{className:"avatar",children:s.jsx("img",{src:"/images/user.png",alt:""})}),s.jsxs("div",{className:"about",children:[s.jsxs("div",{className:"about__col col",children:[s.jsxs("div",{className:"name",children:[s.jsxs(_,{to:`/user/${e.author_id}`,style:{textDecoration:"none",color:"black"},children:[(t=e.author)==null?void 0:t.name," ",(a=e.author)==null?void 0:a.last_name," "]}),s.jsx("img",{src:"/images/star.svg",alt:""})," ",s.jsx("span",{children:"0"})]}),s.jsx("div",{className:"date",children:g(e.created_at)})]}),s.jsx("div",{className:"about__col col col-blue",children:s.jsx("span",{children:(r=e.author)==null?void 0:r.education})})]})]}),s.jsx("div",{className:"post__row row",children:h(e)&&s.jsx("img",{src:h(e),alt:""})}),s.jsxs("div",{className:"post__col col",children:[s.jsx("strong",{className:"title",children:e.title}),s.jsx("div",{className:"text",children:e.content})]}),s.jsxs("div",{className:"post__row row row-space",children:[s.jsxs("div",{children:[s.jsx("button",{className:"like",onClick:()=>x(e.id),children:s.jsx("img",{src:"/images/like.svg",alt:""})}),s.jsxs("span",{children:[" ",e.likes," "]})]}),s.jsx("p",{className:"blue-bold",children:e!=null&&e.parsed_hashtags?e==null?void 0:e.parsed_hashtags[0]:""})]})]})})})})};export{w as default};
