import{r as s,u as f,j as n}from"./index-9b232465.js";const j=()=>{const[l,d]=s.useState([]),[u,p]=s.useState([]),[c,h]=s.useState([]),m=f(),[t,i]=s.useState({photoPreview:"",name:"",birthday:"",university:"1",faculty_id:"1",department:"1",about:""}),o=s.useRef(null);function v(e){i({...t,photoPreview:URL.createObjectURL(e.target.files[0])})}async function y(){let e=await fetch(`/api/universities/university/${t.university}/department/${t.faculty_id}/group/${t.department}/requests/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});e=await fetch("/api/students/students/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({birthday:"2000.01.01",description:t.about,faculty_id:String(t.faculty_id),first_name:t.name.split(" ")[0],last_name:t.name.split(" ")[1]})}),e.ok&&(e=await e.json(),localStorage.setItem("user",JSON.stringify(e)),m("/lk/feed"))}return s.useLayoutEffect(()=>{async function e(){let a=await fetch("/api/universities/university/");a=await a.json(),d(a),i({...t,university:a[0].id})}e()},[]),s.useEffect(()=>{async function e(){if(t.university){let a=await fetch(`/api/universities/university/${t.university}/department/`);a=await a.json(),p(a),i({...t,faculty_id:a[0].id})}}e()},[t.university]),s.useEffect(()=>{console.log(t)},[t]),s.useEffect(()=>{async function e(){if(t.university){let a=await fetch(`/api/universities/university/${t.university}/department/${t.faculty_id}/group/`);a=await a.json(),h(a),i({...t,department:a[0].id})}}e()},[t.faculty_id]),n.jsxs("main",{className:"student-reg reg",children:[n.jsxs("div",{className:"reg__row",children:[n.jsxs("div",{className:"avatar",children:[n.jsx("img",{src:t.photoPreview,alt:""}),n.jsx("input",{value:"",onChange:e=>v(e),style:{display:"none"},ref:o,type:"file"}),n.jsx("button",{onClick:()=>o.current.click(),children:"Добавить фото"})]}),n.jsxs("div",{className:"info",children:[n.jsx("label",{htmlFor:"name",children:n.jsx("p",{children:"Имя и фамилия"})}),n.jsx("input",{id:"name",value:t.name,onChange:e=>i({...t,name:e.target.value}),type:"text"}),n.jsx("label",{htmlFor:"university",children:n.jsx("p",{children:"Университет"})}),n.jsx("select",{name:"university",id:"",value:l[t.university],onChange:e=>{const a=e.target.selectedOptions[0].getAttribute("name");i({...t,university:a})},children:l.map(e=>n.jsx("option",{value:e.name,name:e.id,children:e.name},e.name+e.id))}),n.jsx("label",{htmlFor:"faculty",children:n.jsx("p",{children:"Факультет"})}),n.jsx("select",{name:"faculty",value:u[t.faculty_id],id:"",children:u.map(e=>n.jsx("option",{value:e.name,onChange:a=>{const r=a.target.selectedOptions[0].getAttribute("name");i({...t,faculty_id:r})},name:e.id,children:e.name},e.name+e.id))}),n.jsx("label",{htmlFor:"department",children:n.jsx("p",{children:"Кафедра"})}),n.jsx("select",{name:"department",id:"",value:c[t.department],children:c.map(e=>n.jsx("option",{onChange:a=>{const r=a.target.selectedOptions[0].getAttribute("name");i({...t,department:r})},value:e.name,name:e.id,children:e.name},e.name+e.id))})]})]}),n.jsx("textarea",{value:t.about,onChange:e=>i({...t,about:e.target.value}),placeholder:"О себе"}),n.jsx("br",{}),n.jsx("button",{onClick:y,children:"Зарегистрироваться"})]})};export{j as default};
